{"version":3,"sources":["turbopack:///[project]/lumora/packages/db/env.ts","turbopack:///[project]/lumora/packages/db/AnalyticsEvent.ts","turbopack:///[project]/lumora/packages/db/CounselingContact.ts","turbopack:///[project]/lumora/packages/db/MessageLog.ts","turbopack:///[project]/lumora/packages/db/OutreachAudit.ts","turbopack:///[project]/lumora/packages/db/Session.ts"],"sourcesContent":["import { z } from 'zod';\n\n// type Provider = 'openai' | 'gemini';\ntype Provider = 'openai' | 'gemini';\n\n\nconst RawEnvSchema = z\n  .object({\n    AI_PROVIDER: z.enum(['openai', 'gemini']).optional(),\n    OPENAI_API_KEY: z.string().min(1).optional(),\n    GEMINI_API_KEY: z.string().min(1).optional(),\n    // MONGODB_URI: z.string().min(1),\n    MAIL_HOST: z.string().optional(),\n    MAIL_PORT: z.string().optional(),\n    MAIL_USER: z.string().optional(),\n    MAIL_PASSWORD: z.string().optional(),\n    MAIL_API_KEY: z.string().optional(),\n    COUNSELING_INBOX: z.string().email().optional(),\n    COUNSELING_CONTACTS_JSON: z.string().optional(),\n  })\n  .superRefine((val, ctx) => {\n    const provider =\n      val.AI_PROVIDER ?? (val.OPENAI_API_KEY ? 'openai' : val.GEMINI_API_KEY ? 'gemini' : undefined);\n\n    if (!provider) {\n      ctx.addIssue({\n        code: z.ZodIssueCode.custom,\n        message: 'Configure AI_PROVIDER or provide at least one API key for OpenAI or Gemini.',\n        path: ['AI_PROVIDER'],\n      });\n      return;\n    }\n\n    if (provider === 'openai' && !val.OPENAI_API_KEY) {\n      ctx.addIssue({\n        code: z.ZodIssueCode.custom,\n        message: 'OPENAI_API_KEY is required when AI_PROVIDER resolves to \"openai\".',\n        path: ['OPENAI_API_KEY'],\n      });\n    }\n\n    if (provider === 'gemini' && !val.GEMINI_API_KEY) {\n      ctx.addIssue({\n        code: z.ZodIssueCode.custom,\n        message: 'GEMINI_API_KEY is required when AI_PROVIDER resolves to \"gemini\".',\n        path: ['GEMINI_API_KEY'],\n      });\n    }\n  });\n\nconst rawEnv = RawEnvSchema.parse({\n  AI_PROVIDER: process.env.AI_PROVIDER,\n  OPENAI_API_KEY: process.env.OPENAI_API_KEY,\n  GEMINI_API_KEY: process.env.GEMINI_API_KEY,\n  // MONGODB_URI: process.env.MONGODB_URI,\n  MAIL_HOST: process.env.MAIL_HOST,\n  MAIL_PORT: process.env.MAIL_PORT,\n  MAIL_USER: process.env.MAIL_USER,\n  MAIL_PASSWORD: process.env.MAIL_PASSWORD,\n  MAIL_API_KEY: process.env.MAIL_API_KEY,\n  COUNSELING_INBOX: process.env.COUNSELING_INBOX,\n  COUNSELING_CONTACTS_JSON: process.env.COUNSELING_CONTACTS_JSON,\n});\n\nconst computedProvider = ((): Provider => {\n  if (rawEnv.AI_PROVIDER) {\n    return rawEnv.AI_PROVIDER;\n  }\n  if (rawEnv.OPENAI_API_KEY) {\n    return 'openai';\n  }\n  return 'gemini';\n})();\n\nexport const env = {\n  ...rawEnv,\n  AI_PROVIDER: computedProvider,\n} satisfies typeof rawEnv & { AI_PROVIDER: Provider };\n","import { Schema, model, models } from 'mongoose';\n\nconst AnalyticsEventSchema = new Schema(\n  {\n    sessionId: { type: String, required: true, index: true },\n    type: { type: String, required: true },\n    meta: { type: Schema.Types.Mixed },\n    createdAt: { type: Date, default: Date.now },\n  },\n  { timestamps: false }\n);\n\n// TTL: 30 days\nAnalyticsEventSchema.index({ createdAt: 1 }, { expireAfterSeconds: 60 * 60 * 24 * 30 });\n\nexport type AnalyticsEventDoc = {\n  sessionId: string;\n  type: string;\n  meta?: Record<string, unknown>;\n  createdAt: Date;\n};\n\nexport const AnalyticsEvent = models.AnalyticsEvent || model('AnalyticsEvent', AnalyticsEventSchema);\n\n","import { Schema, model, models } from 'mongoose';\n\nconst CounselingContactSchema = new Schema(\n  {\n    name: { type: String, required: true },\n    phone: { type: String },\n    email: { type: String },\n    hours: { type: String },\n    locationUrl: { type: String },\n  },\n  { timestamps: false }\n);\n\nexport type CounselingContactDoc = {\n  name: string;\n  phone?: string;\n  email?: string;\n  hours?: string;\n  locationUrl?: string;\n};\n\nexport const CounselingContact = models.CounselingContact || model('CounselingContact', CounselingContactSchema);\n\n\n","import { Schema, model, models } from 'mongoose';\n\nconst MessageLogSchema = new Schema(\n  {\n    sessionId: { type: String, required: true, index: true },\n    role: { type: String, enum: ['user', 'assistant'], required: true },\n    content: { type: String, required: true },\n    createdAt: { type: Date, default: Date.now },\n  },\n  { timestamps: false }\n);\n\n// TTL: 30 days\nMessageLogSchema.index({ createdAt: 1 }, { expireAfterSeconds: 60 * 60 * 24 * 30 });\n\nexport type MessageLogDoc = {\n  sessionId: string;\n  role: 'user' | 'assistant';\n  content: string;\n  createdAt: Date;\n};\n\nexport const MessageLog = models.MessageLog || model('MessageLog', MessageLogSchema);\n\n","import { Schema, model, models } from 'mongoose';\n\nconst OutreachAuditSchema = new Schema(\n  {\n    sessionId: { type: String, required: true, index: true },\n    consent: { type: Boolean, required: true },\n    payloadHash: { type: String, required: true },\n    createdAt: { type: Date, default: Date.now },\n  },\n  { timestamps: false }\n);\n\nexport type OutreachAuditDoc = {\n  sessionId: string;\n  consent: boolean;\n  payloadHash: string;\n  createdAt: Date;\n};\n\nexport const OutreachAudit = models.OutreachAudit || model('OutreachAudit', OutreachAuditSchema);\n\n\n","import { Schema, model, models } from 'mongoose';\n\nconst SessionSchema = new Schema(\n  {\n    sessionId: { type: String, required: true, unique: true, index: true },\n    createdAt: { type: Date, default: Date.now },\n    lastActiveAt: { type: Date, default: Date.now },\n  },\n  { timestamps: false }\n);\n\nexport type SessionDoc = {\n  sessionId: string;\n  createdAt: Date;\n  lastActiveAt: Date;\n};\n\nexport const Session = models.Session || model('Session', SessionSchema);\n\n\n"],"names":[],"mappings":"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"}