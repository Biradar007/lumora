{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 61, "column": 0}, "map": {"version":3,"sources":["file:///Users/udaybiradar/lumora-app/lumora/packages/db/client.ts"],"sourcesContent":["import mongoose from 'mongoose';\n\nconst MONGODB_URI = process.env.MONGODB_URI as string;\n\nif (!MONGODB_URI) {\n  throw new Error('MONGODB_URI is not set');\n}\n\ndeclare global {\n  // eslint-disable-next-line no-var\n  var mongooseConn: { conn: typeof mongoose | null; promise: Promise<typeof mongoose> | null } | undefined;\n}\n\nlet cached = global.mongooseConn;\nif (!cached) {\n  cached = global.mongooseConn = { conn: null, promise: null };\n}\n\nexport async function connectToDatabase(): Promise<typeof mongoose> {\n  if (cached.conn) return cached.conn;\n  if (!cached.promise) {\n    cached.promise = mongoose.connect(MONGODB_URI, {\n      dbName: 'lumora',\n    });\n  }\n  cached.conn = await cached.promise;\n  return cached.conn;\n}\n\n\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW;AAE3C,IAAI,CAAC,aAAa;IAChB,MAAM,IAAI,MAAM;AAClB;AAOA,IAAI,SAAS,OAAO,YAAY;AAChC,IAAI,CAAC,QAAQ;IACX,SAAS,OAAO,YAAY,GAAG;QAAE,MAAM;QAAM,SAAS;IAAK;AAC7D;AAEO,eAAe;IACpB,IAAI,OAAO,IAAI,EAAE,OAAO,OAAO,IAAI;IACnC,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,OAAO,OAAO,GAAG,oHAAQ,CAAC,OAAO,CAAC,aAAa;YAC7C,QAAQ;QACV;IACF;IACA,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IAClC,OAAO,OAAO,IAAI;AACpB","debugId":null}},
    {"offset": {"line": 92, "column": 0}, "map": {"version":3,"sources":["file:///Users/udaybiradar/lumora-app/lumora/packages/db/env.ts"],"sourcesContent":["import { z } from 'zod';\n\n// type Provider = 'openai' | 'gemini';\ntype Provider = 'openai' | 'gemini';\n\n\nconst RawEnvSchema = z\n  .object({\n    AI_PROVIDER: z.enum(['openai', 'gemini']).optional(),\n    OPENAI_API_KEY: z.string().min(1).optional(),\n    GEMINI_API_KEY: z.string().min(1).optional(),\n    MONGODB_URI: z.string().min(1),\n    MAIL_HOST: z.string().optional(),\n    MAIL_PORT: z.string().optional(),\n    MAIL_USER: z.string().optional(),\n    MAIL_PASSWORD: z.string().optional(),\n    MAIL_API_KEY: z.string().optional(),\n    COUNSELING_INBOX: z.string().email().optional(),\n    COUNSELING_CONTACTS_JSON: z.string().optional(),\n  })\n  .superRefine((val, ctx) => {\n    const provider =\n      val.AI_PROVIDER ?? (val.OPENAI_API_KEY ? 'openai' : val.GEMINI_API_KEY ? 'gemini' : undefined);\n\n    if (!provider) {\n      ctx.addIssue({\n        code: z.ZodIssueCode.custom,\n        message: 'Configure AI_PROVIDER or provide at least one API key for OpenAI or Gemini.',\n        path: ['AI_PROVIDER'],\n      });\n      return;\n    }\n\n    if (provider === 'openai' && !val.OPENAI_API_KEY) {\n      ctx.addIssue({\n        code: z.ZodIssueCode.custom,\n        message: 'OPENAI_API_KEY is required when AI_PROVIDER resolves to \"openai\".',\n        path: ['OPENAI_API_KEY'],\n      });\n    }\n\n    if (provider === 'gemini' && !val.GEMINI_API_KEY) {\n      ctx.addIssue({\n        code: z.ZodIssueCode.custom,\n        message: 'GEMINI_API_KEY is required when AI_PROVIDER resolves to \"gemini\".',\n        path: ['GEMINI_API_KEY'],\n      });\n    }\n  });\n\nconst rawEnv = RawEnvSchema.parse({\n  AI_PROVIDER: process.env.AI_PROVIDER,\n  OPENAI_API_KEY: process.env.OPENAI_API_KEY,\n  GEMINI_API_KEY: process.env.GEMINI_API_KEY,\n  MONGODB_URI: process.env.MONGODB_URI,\n  MAIL_HOST: process.env.MAIL_HOST,\n  MAIL_PORT: process.env.MAIL_PORT,\n  MAIL_USER: process.env.MAIL_USER,\n  MAIL_PASSWORD: process.env.MAIL_PASSWORD,\n  MAIL_API_KEY: process.env.MAIL_API_KEY,\n  COUNSELING_INBOX: process.env.COUNSELING_INBOX,\n  COUNSELING_CONTACTS_JSON: process.env.COUNSELING_CONTACTS_JSON,\n});\n\nconst computedProvider = ((): Provider => {\n  if (rawEnv.AI_PROVIDER) {\n    return rawEnv.AI_PROVIDER;\n  }\n  if (rawEnv.OPENAI_API_KEY) {\n    return 'openai';\n  }\n  return 'gemini';\n})();\n\nexport const env = {\n  ...rawEnv,\n  AI_PROVIDER: computedProvider,\n} satisfies typeof rawEnv & { AI_PROVIDER: Provider };\n"],"names":[],"mappings":";;;;AAAA;;AAMA,MAAM,eAAe,yKAAC,CACnB,MAAM,CAAC;IACN,aAAa,yKAAC,CAAC,IAAI,CAAC;QAAC;QAAU;KAAS,EAAE,QAAQ;IAClD,gBAAgB,yKAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,QAAQ;IAC1C,gBAAgB,yKAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,QAAQ;IAC1C,aAAa,yKAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IAC5B,WAAW,yKAAC,CAAC,MAAM,GAAG,QAAQ;IAC9B,WAAW,yKAAC,CAAC,MAAM,GAAG,QAAQ;IAC9B,WAAW,yKAAC,CAAC,MAAM,GAAG,QAAQ;IAC9B,eAAe,yKAAC,CAAC,MAAM,GAAG,QAAQ;IAClC,cAAc,yKAAC,CAAC,MAAM,GAAG,QAAQ;IACjC,kBAAkB,yKAAC,CAAC,MAAM,GAAG,KAAK,GAAG,QAAQ;IAC7C,0BAA0B,yKAAC,CAAC,MAAM,GAAG,QAAQ;AAC/C,GACC,WAAW,CAAC,CAAC,KAAK;IACjB,MAAM,WACJ,IAAI,WAAW,IAAI,CAAC,IAAI,cAAc,GAAG,WAAW,IAAI,cAAc,GAAG,WAAW,SAAS;IAE/F,IAAI,CAAC,UAAU;QACb,IAAI,QAAQ,CAAC;YACX,MAAM,yKAAC,CAAC,YAAY,CAAC,MAAM;YAC3B,SAAS;YACT,MAAM;gBAAC;aAAc;QACvB;QACA;IACF;IAEA,IAAI,aAAa,YAAY,CAAC,IAAI,cAAc,EAAE;QAChD,IAAI,QAAQ,CAAC;YACX,MAAM,yKAAC,CAAC,YAAY,CAAC,MAAM;YAC3B,SAAS;YACT,MAAM;gBAAC;aAAiB;QAC1B;IACF;IAEA,IAAI,aAAa,YAAY,CAAC,IAAI,cAAc,EAAE;QAChD,IAAI,QAAQ,CAAC;YACX,MAAM,yKAAC,CAAC,YAAY,CAAC,MAAM;YAC3B,SAAS;YACT,MAAM;gBAAC;aAAiB;QAC1B;IACF;AACF;AAEF,MAAM,SAAS,aAAa,KAAK,CAAC;IAChC,aAAa,QAAQ,GAAG,CAAC,WAAW;IACpC,gBAAgB,QAAQ,GAAG,CAAC,cAAc;IAC1C,gBAAgB,QAAQ,GAAG,CAAC,cAAc;IAC1C,aAAa,QAAQ,GAAG,CAAC,WAAW;IACpC,WAAW,QAAQ,GAAG,CAAC,SAAS;IAChC,WAAW,QAAQ,GAAG,CAAC,SAAS;IAChC,WAAW,QAAQ,GAAG,CAAC,SAAS;IAChC,eAAe,QAAQ,GAAG,CAAC,aAAa;IACxC,cAAc,QAAQ,GAAG,CAAC,YAAY;IACtC,kBAAkB,QAAQ,GAAG,CAAC,gBAAgB;IAC9C,0BAA0B,QAAQ,GAAG,CAAC,wBAAwB;AAChE;AAEA,MAAM,mBAAmB,CAAC;IACxB,IAAI,OAAO,WAAW,EAAE;QACtB,OAAO,OAAO,WAAW;IAC3B;IACA,IAAI,OAAO,cAAc,EAAE;QACzB,OAAO;IACT;IACA,OAAO;AACT,CAAC;AAEM,MAAM,MAAM;IACjB,GAAG,MAAM;IACT,aAAa;AACf","debugId":null}},
    {"offset": {"line": 174, "column": 0}, "map": {"version":3,"sources":["file:///Users/udaybiradar/lumora-app/lumora/packages/db/AnalyticsEvent.ts"],"sourcesContent":["import { Schema, model, models } from 'mongoose';\n\nconst AnalyticsEventSchema = new Schema(\n  {\n    sessionId: { type: String, required: true, index: true },\n    type: { type: String, required: true },\n    meta: { type: Schema.Types.Mixed },\n    createdAt: { type: Date, default: Date.now },\n  },\n  { timestamps: false }\n);\n\n// TTL: 30 days\nAnalyticsEventSchema.index({ createdAt: 1 }, { expireAfterSeconds: 60 * 60 * 24 * 30 });\n\nexport type AnalyticsEventDoc = {\n  sessionId: string;\n  type: string;\n  meta?: Record<string, unknown>;\n  createdAt: Date;\n};\n\nexport const AnalyticsEvent = models.AnalyticsEvent || model('AnalyticsEvent', AnalyticsEventSchema);\n\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,uBAAuB,IAAI,mHAAM,CACrC;IACE,WAAW;QAAE,MAAM;QAAQ,UAAU;QAAM,OAAO;IAAK;IACvD,MAAM;QAAE,MAAM;QAAQ,UAAU;IAAK;IACrC,MAAM;QAAE,MAAM,mHAAM,CAAC,KAAK,CAAC,KAAK;IAAC;IACjC,WAAW;QAAE,MAAM;QAAM,SAAS,KAAK,GAAG;IAAC;AAC7C,GACA;IAAE,YAAY;AAAM;AAGtB,eAAe;AACf,qBAAqB,KAAK,CAAC;IAAE,WAAW;AAAE,GAAG;IAAE,oBAAoB,KAAK,KAAK,KAAK;AAAG;AAS9E,MAAM,iBAAiB,mHAAM,CAAC,cAAc,IAAI,IAAA,kHAAK,EAAC,kBAAkB","debugId":null}},
    {"offset": {"line": 211, "column": 0}, "map": {"version":3,"sources":["file:///Users/udaybiradar/lumora-app/lumora/packages/db/CounselingContact.ts"],"sourcesContent":["import { Schema, model, models } from 'mongoose';\n\nconst CounselingContactSchema = new Schema(\n  {\n    name: { type: String, required: true },\n    phone: { type: String },\n    email: { type: String },\n    hours: { type: String },\n    locationUrl: { type: String },\n  },\n  { timestamps: false }\n);\n\nexport type CounselingContactDoc = {\n  name: string;\n  phone?: string;\n  email?: string;\n  hours?: string;\n  locationUrl?: string;\n};\n\nexport const CounselingContact = models.CounselingContact || model('CounselingContact', CounselingContactSchema);\n\n\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,0BAA0B,IAAI,mHAAM,CACxC;IACE,MAAM;QAAE,MAAM;QAAQ,UAAU;IAAK;IACrC,OAAO;QAAE,MAAM;IAAO;IACtB,OAAO;QAAE,MAAM;IAAO;IACtB,OAAO;QAAE,MAAM;IAAO;IACtB,aAAa;QAAE,MAAM;IAAO;AAC9B,GACA;IAAE,YAAY;AAAM;AAWf,MAAM,oBAAoB,mHAAM,CAAC,iBAAiB,IAAI,IAAA,kHAAK,EAAC,qBAAqB","debugId":null}},
    {"offset": {"line": 242, "column": 0}, "map": {"version":3,"sources":["file:///Users/udaybiradar/lumora-app/lumora/packages/db/MessageLog.ts"],"sourcesContent":["import { Schema, model, models } from 'mongoose';\n\nconst MessageLogSchema = new Schema(\n  {\n    sessionId: { type: String, required: true, index: true },\n    role: { type: String, enum: ['user', 'assistant'], required: true },\n    content: { type: String, required: true },\n    createdAt: { type: Date, default: Date.now },\n  },\n  { timestamps: false }\n);\n\n// TTL: 30 days\nMessageLogSchema.index({ createdAt: 1 }, { expireAfterSeconds: 60 * 60 * 24 * 30 });\n\nexport type MessageLogDoc = {\n  sessionId: string;\n  role: 'user' | 'assistant';\n  content: string;\n  createdAt: Date;\n};\n\nexport const MessageLog = models.MessageLog || model('MessageLog', MessageLogSchema);\n\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,mBAAmB,IAAI,mHAAM,CACjC;IACE,WAAW;QAAE,MAAM;QAAQ,UAAU;QAAM,OAAO;IAAK;IACvD,MAAM;QAAE,MAAM;QAAQ,MAAM;YAAC;YAAQ;SAAY;QAAE,UAAU;IAAK;IAClE,SAAS;QAAE,MAAM;QAAQ,UAAU;IAAK;IACxC,WAAW;QAAE,MAAM;QAAM,SAAS,KAAK,GAAG;IAAC;AAC7C,GACA;IAAE,YAAY;AAAM;AAGtB,eAAe;AACf,iBAAiB,KAAK,CAAC;IAAE,WAAW;AAAE,GAAG;IAAE,oBAAoB,KAAK,KAAK,KAAK;AAAG;AAS1E,MAAM,aAAa,mHAAM,CAAC,UAAU,IAAI,IAAA,kHAAK,EAAC,cAAc","debugId":null}},
    {"offset": {"line": 284, "column": 0}, "map": {"version":3,"sources":["file:///Users/udaybiradar/lumora-app/lumora/packages/db/OutreachAudit.ts"],"sourcesContent":["import { Schema, model, models } from 'mongoose';\n\nconst OutreachAuditSchema = new Schema(\n  {\n    sessionId: { type: String, required: true, index: true },\n    consent: { type: Boolean, required: true },\n    payloadHash: { type: String, required: true },\n    createdAt: { type: Date, default: Date.now },\n  },\n  { timestamps: false }\n);\n\nexport type OutreachAuditDoc = {\n  sessionId: string;\n  consent: boolean;\n  payloadHash: string;\n  createdAt: Date;\n};\n\nexport const OutreachAudit = models.OutreachAudit || model('OutreachAudit', OutreachAuditSchema);\n\n\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,sBAAsB,IAAI,mHAAM,CACpC;IACE,WAAW;QAAE,MAAM;QAAQ,UAAU;QAAM,OAAO;IAAK;IACvD,SAAS;QAAE,MAAM;QAAS,UAAU;IAAK;IACzC,aAAa;QAAE,MAAM;QAAQ,UAAU;IAAK;IAC5C,WAAW;QAAE,MAAM;QAAM,SAAS,KAAK,GAAG;IAAC;AAC7C,GACA;IAAE,YAAY;AAAM;AAUf,MAAM,gBAAgB,mHAAM,CAAC,aAAa,IAAI,IAAA,kHAAK,EAAC,iBAAiB","debugId":null}},
    {"offset": {"line": 316, "column": 0}, "map": {"version":3,"sources":["file:///Users/udaybiradar/lumora-app/lumora/packages/db/Session.ts"],"sourcesContent":["import { Schema, model, models } from 'mongoose';\n\nconst SessionSchema = new Schema(\n  {\n    sessionId: { type: String, required: true, unique: true, index: true },\n    createdAt: { type: Date, default: Date.now },\n    lastActiveAt: { type: Date, default: Date.now },\n  },\n  { timestamps: false }\n);\n\nexport type SessionDoc = {\n  sessionId: string;\n  createdAt: Date;\n  lastActiveAt: Date;\n};\n\nexport const Session = models.Session || model('Session', SessionSchema);\n\n\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,gBAAgB,IAAI,mHAAM,CAC9B;IACE,WAAW;QAAE,MAAM;QAAQ,UAAU;QAAM,QAAQ;QAAM,OAAO;IAAK;IACrE,WAAW;QAAE,MAAM;QAAM,SAAS,KAAK,GAAG;IAAC;IAC3C,cAAc;QAAE,MAAM;QAAM,SAAS,KAAK,GAAG;IAAC;AAChD,GACA;IAAE,YAAY;AAAM;AASf,MAAM,UAAU,mHAAM,CAAC,OAAO,IAAI,IAAA,kHAAK,EAAC,WAAW","debugId":null}},
    {"offset": {"line": 345, "column": 0}, "map": {"version":3,"sources":["file:///Users/udaybiradar/lumora-app/lumora/packages/db/index.ts"],"sourcesContent":["export * from './client';\nexport * from './env';\nexport * from './AnalyticsEvent';\nexport * from './CounselingContact';\nexport * from './MessageLog';\nexport * from './OutreachAudit';\nexport * from './Session';\n\n"],"names":[],"mappings":";AAAA;AACA;AACA;AACA;AACA;AACA;AACA","debugId":null}},
    {"offset": {"line": 364, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 370, "column": 0}, "map": {"version":3,"sources":["file:///Users/udaybiradar/lumora-app/lumora/packages/core/constants.ts"],"sourcesContent":["export const SYSTEM_PROMPT = `You are Lumora, a supportive mental-health companion.\n                              You are not a therapist and do not provide medical diagnoses.\n                              Use warm, concise, validating language.\n                              When you sense distress, show empathy first, then suggest practical next steps.\n                              If risk is high, share self-help tools and campus counseling resources.\n                              If asked, offer a consented outreach option.\n                              If the user states they are in immediate danger, advise contacting emergency services (911 in the U.S.).\n                              Avoid clinical labels; focus on support and safety.\n                              Campus Resources (always share when crisis is mentioned):\n                              Call 24/7: (657) 278-3040\n                              Visit (Mon–Fri, 8 AM–5 PM): Titan Hall, 1st Floor\n                              Address: 1111 N. State College Blvd, Titan Hall 1st & 3rd Floor\n                              \n                              Example 1: Everyday stress\n                              User: I’ve been so overwhelmed with classes. It feels like I can’t keep up.\n                              Lumora: That sounds really tough. \n                                      It’s okay to feel overwhelmed, many students do. \n                                      Taking things one step at a time can help. \n                                      Would you like me to share some quick ways to manage stress this week?\n                              \n                              Example 2: Higher distress\n                              User: I don’t see the point of anything lately. I just want it all to stop.\n                              Lumora: I’m really sorry you’re feeling this way. \n                                      You’re not alone. Talking with someone you trust or your campus counseling center can help. \n                                      If you’re in crisis, please call (657) 278-3040 anytime or visit Titan Hall, 1st Floor (Mon–Fri, 8 AM–5 PM) at 1111 N. State College Blvd. \n                                      If you’re in immediate danger, please call 911 or go to the nearest safe place.\n\n                              Example 3: Non-Crisis Resource Request\n                              User: Where can I book a counseling appointment on campus?\n                              Lumora: You can call the counseling center at (657) 278-3040 to schedule an appointment. \n                                      They’re also available in person at Titan Hall, 1st Floor (Mon–Fri, 8 AM–5 PM) at 1111 N. State College Blvd. \n                                      Would you like me to share some tips on preparing for your first visit?`;\n\nexport const RISK_KEYWORDS = {\n  RED: [\n    \"suicide\",\n    \"kill myself\",\n    \"end it all\",\n    \"not worth living\",\n    \"harm myself\",\n    \"hurt myself\",\n    \"self harm\",\n    \"cut myself\",\n    \"overdose\",\n    \"take pills\",\n    \"jump off\",\n    \"hang myself\",\n  ],\n  YELLOW: [\n    \"depressed\",\n    \"hopeless\",\n    \"worthless\",\n    \"useless\",\n    \"anxiety\",\n    \"panic\",\n    \"overwhelmed\",\n    \"stressed\",\n    \"can't cope\",\n    \"breaking down\",\n    \"falling apart\",\n  ],\n};\n\nexport const SESSION_COOKIE_NAME = \"lumora_session\";\nexport const SESSION_COOKIE_MAX_AGE = 60 * 60 * 24 * 90; // 90 days\nexport const DATA_RETENTION_DAYS = 30;\n\n"],"names":[],"mappings":";;;;;;;;;;;;AAAO,MAAM,gBAAgB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;6GA+B+E,CAAC;AAEvG,MAAM,gBAAgB;IAC3B,KAAK;QACH;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;IACD,QAAQ;QACN;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;AACH;AAEO,MAAM,sBAAsB;AAC5B,MAAM,yBAAyB,KAAK,KAAK,KAAK,IAAI,UAAU;AAC5D,MAAM,sBAAsB","debugId":null}},
    {"offset": {"line": 450, "column": 0}, "map": {"version":3,"sources":["file:///Users/udaybiradar/lumora-app/lumora/packages/core/index.ts"],"sourcesContent":["export * from './types';\nexport * from './constants';\n\n"],"names":[],"mappings":";AAAA;AACA","debugId":null}},
    {"offset": {"line": 459, "column": 0}, "map": {"version":3,"sources":["file:///Users/udaybiradar/lumora-app/lumora/apps/web/src/app/api/chat/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { env } from '@lumora/db';\nimport { SYSTEM_PROMPT } from '@lumora/core';\nimport OpenAI from 'openai';\nimport { GoogleGenerativeAI } from '@google/generative-ai';\n\ntype Provider = 'openai' | 'gemini';\n\nconst DEFAULT_OPENAI_MODEL = 'gpt-4o-mini';\nconst DEFAULT_GEMINI_MODEL = 'gemini-2.5-flash';\n\nlet openaiClient: OpenAI | undefined;\nlet geminiClient: GoogleGenerativeAI | undefined;\n\nconst getOpenAIClient = () => {\n  if (!env.OPENAI_API_KEY) {\n    throw new Error('OPENAI_API_KEY is not configured');\n  }\n  if (!openaiClient) {\n    openaiClient = new OpenAI({ apiKey: env.OPENAI_API_KEY });\n  }\n  return openaiClient;\n};\n\nconst getGeminiClient = () => {\n  if (!env.GEMINI_API_KEY) {\n    throw new Error('GEMINI_API_KEY is not configured');\n  }\n  if (!geminiClient) {\n    geminiClient = new GoogleGenerativeAI(env.GEMINI_API_KEY);\n  }\n  return geminiClient;\n};\n\nconst isProvider = (value: unknown): value is Provider => value === 'openai' || value === 'gemini';\n\nexport async function POST(request: Request) {\n  try {\n    const { sessionId, messages, provider } = (await request.json()) as {\n      sessionId?: string;\n      messages?: { role: 'user' | 'assistant' | 'system'; content: string }[];\n      provider?: Provider;\n    };\n    if (!sessionId || !messages?.length) {\n      return NextResponse.json({ error: 'invalid_request' }, { status: 400 });\n    }\n\n    const resolvedProvider: Provider = isProvider(provider) ? provider : env.AI_PROVIDER;\n\n    let reply: string | undefined;\n\n    if (resolvedProvider === 'gemini') {\n      try {\n        const model = getGeminiClient().getGenerativeModel({ model: DEFAULT_GEMINI_MODEL });\n        const completion = await model.generateContent({\n          contents: messages\n            .filter(m => m.role !== 'system')\n            .map(m => ({\n              role: m.role === 'assistant' ? 'model' : 'user',\n              parts: [{ text: m.content }],\n            })),\n          systemInstruction: {\n            role: 'system',\n            parts: [{ text: SYSTEM_PROMPT }],\n          },\n          generationConfig: {\n            temperature: 0.7,\n            maxOutputTokens: 400,\n          },\n        });\n      reply = completion.response.text()?.trim();\n      } catch (err) {\n        console.error('[api/chat] gemini error', err);\n        return NextResponse.json({ error: 'gemini_error' }, { status: 500 });\n      }\n    } else {\n      const convo = [\n        { role: 'system' as const, content: SYSTEM_PROMPT },\n        ...messages.map(m => ({ role: m.role, content: m.content })),\n      ];\n\n      const completion = await getOpenAIClient().chat.completions.create({\n        model: DEFAULT_OPENAI_MODEL,\n        messages: convo,\n        temperature: 0.7,\n        max_tokens: 200, //400\n      });\n\n      reply = completion.choices[0]?.message?.content?.trim();\n    }\n\n    const safeReply = reply || 'Thank you for sharing. I am here to listen.';\n\n    return NextResponse.json({ reply: safeReply, provider: resolvedProvider });\n  } catch (err) {\n    console.error('[api/chat] unexpected error', err);\n    return NextResponse.json({ error: 'server_error' }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;;;;;;AAIA,MAAM,uBAAuB;AAC7B,MAAM,uBAAuB;AAE7B,IAAI;AACJ,IAAI;AAEJ,MAAM,kBAAkB;IACtB,IAAI,CAAC,wIAAG,CAAC,cAAc,EAAE;QACvB,MAAM,IAAI,MAAM;IAClB;IACA,IAAI,CAAC,cAAc;QACjB,eAAe,IAAI,mLAAM,CAAC;YAAE,QAAQ,wIAAG,CAAC,cAAc;QAAC;IACzD;IACA,OAAO;AACT;AAEA,MAAM,kBAAkB;IACtB,IAAI,CAAC,wIAAG,CAAC,cAAc,EAAE;QACvB,MAAM,IAAI,MAAM;IAClB;IACA,IAAI,CAAC,cAAc;QACjB,eAAe,IAAI,sLAAkB,CAAC,wIAAG,CAAC,cAAc;IAC1D;IACA,OAAO;AACT;AAEA,MAAM,aAAa,CAAC,QAAsC,UAAU,YAAY,UAAU;AAEnF,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,EAAE,SAAS,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAI,MAAM,QAAQ,IAAI;QAK7D,IAAI,CAAC,aAAa,CAAC,UAAU,QAAQ;YACnC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAkB,GAAG;gBAAE,QAAQ;YAAI;QACvE;QAEA,MAAM,mBAA6B,WAAW,YAAY,WAAW,wIAAG,CAAC,WAAW;QAEpF,IAAI;QAEJ,IAAI,qBAAqB,UAAU;YACjC,IAAI;gBACF,MAAM,QAAQ,kBAAkB,kBAAkB,CAAC;oBAAE,OAAO;gBAAqB;gBACjF,MAAM,aAAa,MAAM,MAAM,eAAe,CAAC;oBAC7C,UAAU,SACP,MAAM,CAAC,CAAA,IAAK,EAAE,IAAI,KAAK,UACvB,GAAG,CAAC,CAAA,IAAK,CAAC;4BACT,MAAM,EAAE,IAAI,KAAK,cAAc,UAAU;4BACzC,OAAO;gCAAC;oCAAE,MAAM,EAAE,OAAO;gCAAC;6BAAE;wBAC9B,CAAC;oBACH,mBAAmB;wBACjB,MAAM;wBACN,OAAO;4BAAC;gCAAE,MAAM,0JAAa;4BAAC;yBAAE;oBAClC;oBACA,kBAAkB;wBAChB,aAAa;wBACb,iBAAiB;oBACnB;gBACF;gBACF,QAAQ,WAAW,QAAQ,CAAC,IAAI,IAAI;YACpC,EAAE,OAAO,KAAK;gBACZ,QAAQ,KAAK,CAAC,2BAA2B;gBACzC,OAAO,gJAAY,CAAC,IAAI,CAAC;oBAAE,OAAO;gBAAe,GAAG;oBAAE,QAAQ;gBAAI;YACpE;QACF,OAAO;YACL,MAAM,QAAQ;gBACZ;oBAAE,MAAM;oBAAmB,SAAS,0JAAa;gBAAC;mBAC/C,SAAS,GAAG,CAAC,CAAA,IAAK,CAAC;wBAAE,MAAM,EAAE,IAAI;wBAAE,SAAS,EAAE,OAAO;oBAAC,CAAC;aAC3D;YAED,MAAM,aAAa,MAAM,kBAAkB,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;gBACjE,OAAO;gBACP,UAAU;gBACV,aAAa;gBACb,YAAY;YACd;YAEA,QAAQ,WAAW,OAAO,CAAC,EAAE,EAAE,SAAS,SAAS;QACnD;QAEA,MAAM,YAAY,SAAS;QAE3B,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;YAAW,UAAU;QAAiB;IAC1E,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;IACpE;AACF","debugId":null}}]
}