{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///Users/udaybiradar/lumora-app/lumora/apps/web/src/app/page.tsx"],"sourcesContent":["\"use client\";\nimport { useEffect, useMemo, useRef, useState } from 'react';\nimport SelfHelp from '@/components/SelfHelp';\nimport ResourcesCard from '@/components/ResourcesCard';\nimport OutreachModal from '@/components/OutreachModal';\n\ntype Msg = { role: 'user' | 'assistant'; content: string; at: number };\n\nexport default function Home() {\n  const [messages, setMessages] = useState<Msg[]>([\n    { role: 'assistant', content: 'Hi, I’m Lumora. How are you feeling today?', at: Date.now() },\n  ]);\n  const [input, setInput] = useState('');\n  const [tier, setTier] = useState<'GREEN' | 'YELLOW' | 'RED'>('GREEN');\n  const [outreachOpen, setOutreachOpen] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const sessionId = useMemo(() => (document.cookie.split('; ').find(c => c.startsWith('lumora_session='))?.split('=')[1] || 'anon'), []);\n  const listRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    listRef.current?.scrollTo({ top: listRef.current.scrollHeight });\n  }, [messages]);\n\n  async function sendAnalytics(type: 'SELF_HELP_USED' | 'RESOURCES_VIEWED' | 'OUTREACH_REQUESTED' | 'MESSAGE_SENT', meta?: object) {\n    await fetch('/api/analytics/event', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ sessionId, type, meta }) });\n  }\n\n  async function handleSend() {\n    if (!input.trim()) return;\n    const userText = input.trim();\n    setInput('');\n    setMessages(m => [...m, { role: 'user', content: userText, at: Date.now() }]);\n    setLoading(true);\n    await sendAnalytics('MESSAGE_SENT');\n\n    const riskRes = await fetch('/api/risk-check', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ text: userText }) });\n    const risk = await riskRes.json();\n    setTier(risk.tier);\n\n    const chatRes = await fetch('/api/chat', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ sessionId, messages: messages.concat({ role: 'user', content: userText, at: Date.now() }).map(({ role, content }) => ({ role, content })) }) });\n    const data = await chatRes.json();\n    setMessages(m => [...m, { role: 'assistant', content: data.reply, at: Date.now() }]);\n    setLoading(false);\n  }\n\n  return (\n    <main className=\"min-h-screen grid grid-cols-1 md:grid-cols-3\">\n      <div className=\"md:col-span-2 flex flex-col border-r\">\n        <header className=\"p-4 border-b\">\n          <h1 className=\"text-xl font-semibold\">Lumora — Light for the mind.</h1>\n        </header>\n        {tier === 'RED' ? (\n          <div className=\"bg-red-50 text-red-800 p-3 text-sm text-center\">If you feel unsafe or at risk of immediate harm, call 911 (US) or your local emergency number.</div>\n        ) : null}\n        <div ref={listRef} className=\"flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50\">\n          {messages.map((m, i) => (\n            <div key={i} className={`max-w-lg ${m.role === 'user' ? 'ml-auto text-right' : ''}`}>\n              <div className={`inline-block px-3 py-2 rounded ${m.role === 'user' ? 'bg-blue-600 text-white' : 'bg-white border'}`}>{m.content}</div>\n              <div className=\"text-[10px] text-gray-500 mt-1\">{new Date(m.at).toLocaleTimeString()}</div>\n            </div>\n          ))}\n          {(tier === 'YELLOW' || tier === 'RED') && (\n            <SelfHelp onUse={tool => sendAnalytics('SELF_HELP_USED', { tool })} />\n          )}\n          {tier === 'RED' && (\n            <div className=\"mt-2\">\n              <button className=\"px-3 py-1 bg-red-600 text-white rounded\" onClick={() => setOutreachOpen(true)}>Request outreach from Counseling</button>\n            </div>\n          )}\n        </div>\n        <div className=\"p-3 border-t flex gap-2\">\n          <input className=\"flex-1 border rounded px-3 py-2\" value={input} onChange={e => setInput(e.target.value)} placeholder=\"Type your message\" onKeyDown={e => { if (e.key === 'Enter') handleSend(); }} />\n          <button className=\"px-4 py-2 bg-blue-600 text-white rounded\" onClick={handleSend} disabled={loading}>{loading ? '...' : 'Send'}</button>\n          <button className=\"px-3 py-2 bg-gray-100 rounded\" onClick={() => fetch('/api/session/clear', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ sessionId }) })}>Clear</button>\n          <a className=\"px-3 py-2 text-sm underline\" href=\"/privacy\">Privacy & Safety</a>\n        </div>\n      </div>\n      <aside className=\"p-4 space-y-3\">\n        <ResourcesCard onOpen={() => sendAnalytics('RESOURCES_VIEWED')} />\n      </aside>\n      <OutreachModal open={outreachOpen} onClose={() => { setOutreachOpen(false); sendAnalytics('OUTREACH_REQUESTED'); }} sessionId={sessionId} />\n    </main>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 314, "column": 0}, "map": {"version":3,"sources":["file:///Users/udaybiradar/lumora-app/node_modules/next/src/server/route-modules/app-page/module.compiled.js"],"sourcesContent":["if (process.env.NEXT_RUNTIME === 'edge') {\n  module.exports = require('next/dist/server/route-modules/app-page/module.js')\n} else {\n  if (process.env.__NEXT_EXPERIMENTAL_REACT) {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.prod.js')\n      }\n    }\n  } else {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.prod.js')\n      }\n    }\n  }\n}\n"],"names":["process","env","NEXT_RUNTIME","module","exports","require","__NEXT_EXPERIMENTAL_REACT","NODE_ENV","TURBOPACK"],"mappings":"AAAA,IAAIA,QAAQC,GAAG,CAACC,YAAY,KAAK,QAAQ;;KAElC;IACL,IAAIF,QAAQC,GAAG,CAACK,yBAAyB,EAAE;;SAcpC;QACL,IAAIN,QAAQC,GAAG,CAACM,QAAQ,KAAK,WAAe;YAC1C,IAAIP,QAAQC,GAAG,CAACO,SAAS,eAAE;gBACzBL,OAAOC,OAAO,GAAGC,QAAQ;YAC3B,OAAO;;QAGT,OAAO;;IAOT;AACF","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 333, "column": 0}, "map": {"version":3,"sources":["file:///Users/udaybiradar/lumora-app/node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-dev-runtime.ts"],"sourcesContent":["module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactJsxDevRuntime\n"],"names":["module","exports","require","vendored","ReactJsxDevRuntime"],"mappings":"AAAAA,OAAOC,OAAO,GACZC,QAAQ,4HACRC,QAAQ,CAAC,YAAY,CAAEC,kBAAkB","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 338, "column": 0}, "map": {"version":3,"sources":["file:///Users/udaybiradar/lumora-app/node_modules/next/src/server/route-modules/app-page/vendored/ssr/react.ts"],"sourcesContent":["module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.React\n"],"names":["module","exports","require","vendored","React"],"mappings":"AAAAA,OAAOC,OAAO,GACZC,QAAQ,4HACRC,QAAQ,CAAC,YAAY,CAAEC,KAAK","ignoreList":[0],"debugId":null}}]
}